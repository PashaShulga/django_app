{% block product_header %}
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:300,600,400" rel="stylesheet" type="text/css">

    <link rel="stylesheet" type="text/css" href="/static/jsgrid/jsgrid.min.css">
    <link rel="stylesheet" type="text/css" href="/static/jsgrid/jsgrid-theme.min.css">

    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/cupertino/jquery-ui.css">
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js"></script>

    <script>window.jQuery || document.write('<script src="/js/jquery-1.8.3.js"><\/script>')</script>

    <script src="/static/jsgrid/jsgrid.min.js"></script>
    <script src="/static/jsgrid/i18n/jsgrid-fr.js"></script>
{% endblock %}

{% block product_content %}

    <div class="col-lg-12">
        {% for table in tables %}
            <H2>Table: <strong style="color: red;">{{ table }}</strong></H2>
            <div id="{{ table }}" class="jsGrid"></div>
        {% endfor %}

    </div>

    <script>
{% autoescape off %}
            var clients = {{ items }};
        {% endautoescape %}
var c = 0;
{% for table in tables %}
        $("#{{ table }}").jsGrid({

            width: "100%",

            inserting: true,
            sorting: true,
            editing: true,
            paging: true,
            autoload: true,
            confirmDeleting: false,
            pageSize: 15,
            pageButtonCount: 5,

            controller: {
                loadData: function () {
                    return clients[c];
                },

                insertItem: function (item) {
                    item.csrfmiddlewaretoken = '{{ csrf_token }}';
                    return $.ajax({
                        type: "POST",
                        url: "{{ request.path }}insert/",
                        data: item,
                        dataType: "json",
                        success: window.location.href = "{{ request.path }}"
                    });
                },

                updateItem: function (item) {
                    item.csrfmiddlewaretoken = '{{ csrf_token }}';
                    return $.ajax({
                        type: "PUT",
                        url: "{{ request.path }}update/",
                        data: item,
                        dataType: "json",
                        success: window.location.href = "{{ request.path }}"
                    });
                },

                deleteItem: function (item) {
                    item.csrfmiddlewaretoken = '{{ csrf_token }}';
                    return $.ajax({
                        type: "DELETE",
                        url: "{{ request.path }}delete/",
                        data: item,
                        dataType: "json",
                        success: window.location.href = "{{ request.path }}"
                    });
                }
            },

            {% autoescape off %}
                fields: [{
                    headerTemplate: function () {
                        return $("<button>").attr("type", "button").text("Delete")
                                .on("click", function () {
                                    deleteSelectedItems();
                                });
                    },
                    itemTemplate: function (_, item) {
                        return $("<input>").attr("type", "checkbox")
                                .on("change", function () {
                                    return false;
                                })
                                .on("click", function () {

                                    $(this).is(":checked") ? selectItem(item) : unselectItem(item);
                                });
                    },
                    align: "center",
                    width: 75,
                    sorting: false
                }
                ].concat({{ flds }}[c])
            {% endautoescape %}

        });
    c++;
{% endfor %}
        var selectedItems = [];

        var selectItem = function (item) {
            selectedItems.push(item);
        };

        var unselectItem = function (item) {
            selectedItems = $.grep(selectedItems, function (i) {
                return i !== item;
            });
        };

        var deleteSelectedItems = function () {
            if (!selectedItems.length || !confirm("Are you sure?")) {
                return;
            }

            $.each(selectedItems, function (_, item) {
                deleteItem: {
                    item.csrfmiddlewaretoken = '{{ csrf_token }}';
                    return $.ajax({
                        type: "DELETE",
                        url: "{{ request.path }}delete/",
                        data: item,
                        dataType: "json",
                        success: window.location.href = "{{ request.path }}"
                    });
                }
            });

            selectedItems = [];
        };
    </script>

{% endblock %}